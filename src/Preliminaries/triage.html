<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="viewport" content="width=device-width, initial-scale=1" />

      <title>1.2. Triage</title>
    
          <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/s4defs-roles.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/iframe.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/admonitions.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/s4defs-roles.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/iframe.css" type="text/css" />
          <link rel="stylesheet" href="../../_static/css/admonitions.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="../../_static/theme-vendors.js"></script> -->
      <script src="../../_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="1.3. The Checklist" href="the_checklist.html" />
  <link rel="prev" title="1.1. How to Use This Book" href="how_to_use.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../../contents.html" class="home-link">
    
      <span class="site-name">Haskell Optimization Handbook</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../../contents.html#haskell-optimization-handbook"
         class="nav-link ">
         Table of Contents
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../contents.html#indices-and-tables"
         class="nav-link ">
         indices and tables
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../../contents.html#haskell-optimization-handbook"
         class="nav-link ">
         Table of Contents
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../../contents.html#indices-and-tables"
         class="nav-link ">
         indices and tables
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="../../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../contents.html#haskell-optimization-handbook">Table of Contents</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="index.html" class="reference internal ">Preliminaries</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Measurement_Observation/index.html" class="reference internal ">Measurement, Profiling, and Observation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Optimizations/index.html" class="reference internal ">Optimizations</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../Case_Studies/index.html" class="reference internal ">Case Studies</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../../contents.html#indices-and-tables">indices and tables</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../glossary.html" class="reference internal ">Glossary</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../../contents.html">Docs</a> &raquo;</li>
    
      <li><a href="index.html"><span class="section-number">1. </span>Preliminaries</a> &raquo;</li>
    
    <li><span class="section-number">1.2. </span>Triage</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="how_to_use.html"
       title="previous chapter">← <span class="section-number">1.1. </span>How to Use This Book</a>
  </li>
  <li class="next">
    <a href="the_checklist.html"
       title="next chapter"><span class="section-number">1.3. </span>The Checklist →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="triage">
<span id="id1"></span><h1><span class="section-number">1.2. </span>Triage<a class="headerlink" href="#triage" title="Link to this heading">¶</a></h1>
<p>This is a triage; it is the signpost that marks the start of your journey and
should give you enough direction to make your next steps.</p>
<section id="symptoms">
<h2><span class="section-number">1.2.1. </span>Symptoms<a class="headerlink" href="#symptoms" title="Link to this heading">¶</a></h2>
<dl>
<dt>You do not have a problem, but want to learn performance-oriented Haskell</dt><dd><p>Begin with the <a class="reference internal" href="philosophies_of_optimization.html#philosophies-of-optimization-chapter"><span class="std std-ref">Philosophies of Optimization</span></a>. Then read the <a class="reference internal" href="what_makes_fast_hs.html#what-makes-fast-hs-chapter"><span class="std std-ref">the programs of consistent
lethargy</span></a>, and some of the case studies.  This
should give you enough to decide your next steps. If you decide to begin
doing some optimizations see the <a class="reference internal" href="the_checklist.html#the-checklist"><span class="std std-ref">checklist</span></a> for more
ideas.</p>
</dd>
<dt>You have a performance regression that you want to understand and fix</dt><dd><p>You need to diagnose the regression and begin thinking in terms of an
investigation. Read <a class="reference internal" href="how_to_debug.html#how-to-debug-chapter"><span class="std std-ref">how to debug</span></a> to make sure
you know how to make progress. Since you have observed a regression, try to
find a commit or state in your project where you <em>do not</em> observe the
regression. This will let you bisect your project to narrow down the space
of changes that START. You may also consider other forms of profiling and
observation, such as:</p>
<ul class="simple">
<li><p>Running a <a class="reference internal" href="../Measurement_Observation/Stg_RTS_Profiling/ticky_ticky.html#ticky-chapter"><span class="std std-ref">tickyticky</span></a> profile.</p></li>
<li><p><a class="reference internal" href="../Measurement_Observation/Haskell_Profiling/eventlog.html#eventlog-chapter"><span class="std std-ref">Checking the heap</span></a>.</p></li>
<li><p>Inspecting the <a class="reference internal" href="../Measurement_Observation/Core_Profiling/core.html#reading-core"><span class="std std-ref">Core</span></a>.</p></li>
<li><p>Inspecting the <a class="reference internal" href="../Measurement_Observation/Stg_RTS_Profiling/stg.html#reading-stg"><span class="std std-ref">STG</span></a>.</p></li>
<li><p>Observing the <a class="reference internal" href="../Measurement_Observation/Binary_Profiling/cachegrind.html#cachegrind-chapter"><span class="std std-ref">cache behavior</span></a>.</p></li>
<li><p>Observing the <a class="reference internal" href="../Measurement_Observation/Binary_Profiling/linux_perf.html#perf-chapter"><span class="std std-ref">CPU’s Performance Counters</span></a>.</p></li>
</ul>
</dd>
<dt>You have a program that you want to begin optimizing</dt><dd><p>If you are short on time, begin with the <a class="reference internal" href="the_checklist.html#the-checklist"><span class="std std-ref">checklist</span></a>
and then check for <a class="reference internal" href="../Measurement_Observation/Haskell_Profiling/eventlog.html#eventlog-chapter"><span class="std std-ref">memory leaks</span></a>. If not, begin with
the easy changes:</p>
<ul class="simple">
<li><p>Use better datastructures.</p></li>
<li><p>Carry checks in the type system so that the program is not always checking
the same predicates.</p></li>
<li><p>Filter before you enter a hot loop.</p></li>
<li><p>Remove niceties in the hot loops, such as logging.</p></li>
<li><p><a class="reference internal" href="../Measurement_Observation/Haskell_Profiling/eventlog.html#eventlog-chapter"><span class="std std-ref">Check the heap</span></a>. The <a class="reference internal" href="../Case_Studies/klister.html#klister-case-study"><span class="std std-ref">klister</span></a> case study is a good example of this kind of optimization.</p></li>
</ul>
<p>Then move into the more invasive changes such as:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../Optimizations/Code_Changes/unroll_stacks.html#unroll-monad-transformers-chapter"><span class="std std-ref">unrolling</span></a> your monad transformers.</p></li>
<li><p>Using the <a class="reference internal" href="../Optimizations/Code_Changes/oneshot.html#oneshot-monad-chapter"><span class="std std-ref">one-shot monad trick</span></a>.</p></li>
<li><p>Selectively <a class="reference internal" href="../Optimizations/GHC_opt/defunctionalization.html#defunctionalization-chapter"><span class="std std-ref">defunctionalizing</span></a> critical functions.</p></li>
<li><p>Critically analyzing your architecture from a performance perspective.</p></li>
</ul>
</dd>
<dt>You have a program that you’ve optimized, but want to optimize more</dt><dd><p>If you have already harvested the low hanging fruit then you have likely
driven the program into a local maxima. Therefore, if you still need more
speed then you must make more invasive changes, such as we listed
above. However, the best changes you can make will exploit properties of the
problem domain to reduce the work your program must do to arrive at a
result. Often times these will be architectural changes.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>In lieu of having links for you continue in this case. You can search for
data-oriented design to begin refactoring your system in this manner. I
highly recommend this <a class="reference external" href="https://youtu.be/IroPQ150F6c?si=mD486UkpWquFygjr">this talk</a> by Andrew Kelley.</p>
</div>
</dd>
</dl>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="how_to_use.html"
       title="previous chapter">← <span class="section-number">1.1. </span>How to Use This Book</a>
  </li>
  <li class="next">
    <a href="the_checklist.html"
       title="next chapter"><span class="section-number">1.3. </span>The Checklist →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2022-2025, Jeffrey Young (doyougnu).
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>